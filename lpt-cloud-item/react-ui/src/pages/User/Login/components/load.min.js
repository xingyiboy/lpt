/*
 * @Date: 2025-03-17 21:56:08
 * @LastEditors: xingyi && 2416820386@qq.com
 * @LastEditTime: 2025-03-17 21:56:13
 * @FilePath: \react-ui\src\pages\User\Login\load.min.js
 */
const Math = window.Math,
  head = document.getElementsByTagName('head')[0],
  TIMEOUT = 1e4,
  TAC_LOADING_DIV =
    '<div id="tac-loading" style="\n    border: 1px solid #eee;\n    /* background-color: #409EFF; */\n    border-radius: 5px;\n    width: 318px;\n    height: 318px;\n    line-height: 318px;\n    color: #606266;\n    text-align: center;\n    position: relative;\n    box-sizing: border-box;\n">璇风◢绛�...</div>';
function showLoading(e) {
  var t = document.querySelector(e);
  t && (t.innerHTML = TAC_LOADING_DIV);
}
function hideLoading(e) {
  let t = document.querySelector(e);
  t && (t.innerHTML = '');
}
function loadCaptchaScript(e, t, n, r, o) {
  const i = e.scriptUrls,
    c = e.cssUrls,
    l = e.timeout || TIMEOUT;
  let s = i.length + c.length;
  function d(e, i) {
    if ((s--, e && 0 === s)) {
      if ((hideLoading(t.bindEl), !window.TAC))
        throw new Error('TAC鏈姞杞斤紝璇锋鏌ュ湴鍧€鏄惁姝ｇ‘');
      r(new TAC(t, n));
    } else e || (hideLoading(t.bindEl), o(i));
  }
  setTimeout(() => {
    0 !== s && showLoading(t.bindEl);
  }, 10),
    i.forEach(function (e) {
      loadResource('string' == typeof e ? { url: e } : e, d, 'script', l);
    }),
    c.forEach(function (e) {
      loadResource('string' == typeof e ? { url: e } : e, d, 'link', l);
    });
}
function loadResource(e, t, n = 'script', r) {
  if (document.querySelector(`${n}[${'script' === n ? 'src' : 'href'}="${e.url}"]`))
    return void t(!0, e);
  let o = !1;
  const i = document.createElement(n);
  'link' === n ? (i.rel = 'stylesheet') : (i.async = !0),
    (i['script' === n ? 'src' : 'href'] = e.url);
  let c;
  (i.onload = i.onreadystatechange =
    () => {
      o ||
        (i.readyState && 'loaded' !== i.readyState && 'complete' !== i.readyState) ||
        (function t(n) {
          e.checkOnReady
            ? (c = setTimeout(() => {
                e.checkOnReady() ? n() : t(n);
              }, 10))
            : n();
        })(() => {
          (o = !0), setTimeout(() => t(o, e), 0);
        });
    }),
    (i.onerror = () => {
      t((o = !1), e);
    }),
    head.appendChild(i),
    setTimeout(() => {
      o || (c && clearTimeout(c), (i.onload = i.onerror = null), i.remove && i.remove(), t(o, e));
    }, r || TIMEOUT);
}
function loadTAC(e, t, n) {
  return new Promise((r, o) => {
    let i = { ...('string' == typeof e ? { url: e } : e) };
    i.url &&
      (i.url.endsWith('/') || (i.url += '/'),
      i.scriptUrls || (i.scriptUrls = [i.url + 'js/tac.min.js']),
      i.cssUrls || (i.cssUrls = [i.url + 'css/tac.css'])),
      i.scriptUrls && i.cssUrls ? loadCaptchaScript(i, t, n, r, o) : o('璇锋寜鐓ф枃妗ｉ厤缃畉ac');
  });
}
setTimeout(() => {
  let e = document.scripts,
    t = null;
  for (let n = 0; n < e.length; n++)
    if (e[n].src.indexOf('load.js') > 1 || e[n].src.indexOf('load.min.js') > 1) {
      t = e[n].src.substring(e[n].src.indexOf('/'), e[n].src.lastIndexOf('/'));
      break;
    }
}, 100),
  (window.loadCaptchaScript = loadCaptchaScript),
  (window.loadTAC = loadTAC),
  (window.initTAC = loadTAC);
